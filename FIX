import java.io.File
import com.kms.katalon.core.windows.keyword.WindowsBuiltinKeywords as Windows
import com.kms.katalon.core.testobject.WindowsTestObject
import com.kms.katalon.core.testobject.ConditionType
import org.openqa.selenium.Keys

void importFile(String fullFilePath, int timeoutSec = 15) {

    File f = new File(fullFilePath)
    String folderPath = f.getParent()
    String fileNameOnly = f.getName()

    if (!folderPath || !fileNameOnly) {
        throw new IllegalArgumentException("Invalid path: " + fullFilePath)
    }

    focusOpenDialog(timeoutSec)

    WindowsTestObject addressBar = new WindowsTestObject("addressBar")
    addressBar.addProperty("xpath", ConditionType.EQUALS, "//*[@AutomationId='41477' and @ClassName='Edit']")

    WindowsTestObject fileNameField = new WindowsTestObject("fileNameField")
    fileNameField.addProperty("xpath", ConditionType.EQUALS, "//*[@AutomationId='1148' and @ClassName='Edit']")

    Windows.click(addressBar)
    Windows.setText(addressBar, folderPath)
    Windows.sendKeys(addressBar, [Keys.ENTER] as CharSequence[])
    Windows.delay(0.5)

    Windows.click(fileNameField)
    Windows.setText(fileNameField, fileNameOnly)
    Windows.sendKeys(fileNameField, [Keys.ENTER] as CharSequence[])
    Windows.delay(0.5)
}

void focusOpenDialog(int timeoutSec = 15) {

    long end = System.currentTimeMillis() + (timeoutSec * 1000)
    Exception last = null

    while (System.currentTimeMillis() < end) {
        try { Windows.switchToWindowTitle("Ouvrir"); return } catch (Exception e) { last = e }
        try { Windows.switchToWindowTitle("Open");   return } catch (Exception e) { last = e }
        try { Windows.switchToWindowTitle("Abrir");  return } catch (Exception e) { last = e }
        Windows.delay(0.2)
    }

    throw new Exception("Open dialog not found within " + timeoutSec + "s. Last error: " + (last?.getMessage() ?: "n/a"))
}
