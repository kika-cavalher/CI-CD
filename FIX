import static com.kms.katalon.core.testobject.ObjectRepository.findWindowsObject
import static com.kms.katalon.core.testcase.TestCaseFactory.findTestCase
import java.time.LocalDate
import java.time.format.DateTimeFormatter
import com.katalon.keywords.windows.WindowsImageKeywords
import com.kms.katalon.core.model.FailureHandling
import com.kms.katalon.core.webui.keyword.WebUiBuiltInKeywords as WebUI
import com.kms.katalon.core.windows.keyword.WindowsBuiltinKeywords as Windows
import general.Common
import general.ImageLoader
import general.MenuSearch
import general.Table
import internal.GlobalVariable


//Objects and images initialization
String menuName = "Passerelle Bilan"
ImageLoader imageLoader = new ImageLoader()
MenuSearch menuSearch = new MenuSearch()
Common common = new Common()
Table table = new Table()
Map<String, String> images = imageLoader.loadImagePassarele()
Map<String, String> imagesGeneral = imageLoader.loadImagesGeneral()
DateTimeFormatter frmt=DateTimeFormatter.ofPattern("dd/MM/yyyy")
LocalDate recAsOfDate=LocalDate.parse(Windows.getText(findWindowsObject('General/curArreteDate')),frmt)
GlobalVariable.recAsOfDate = recAsOfDate

//Change Envinroment
WebUI.callTestCase(findTestCase('Connection/change env - Admin group'), [:] as Map, FailureHandling.STOP_ON_FAILURE)

//Make a search for Passerelle Bilan-H.Bilan French - IFRS
menuSearch.openAndSearch(menuName, images.menuImage, 25)

//Make a filter 
menuSearch.filterWithTextField(images.section,"PFL")
menuSearch.filterWithTextField(images.remett,"LOAN")
menuSearch.filterWithTextField(images.seuilsJustif,"Commenter")
menuSearch.filterWithTextField(images.statut,"Non Justifi")    

//check if filter was applied
menuSearch.checkIfFilterWasApplied(images.sectionFilter1)

//Add a justification file
table.AjouterUnFichierJustificatif()

//check the message 
common.checkMessage(images.message1,"enregistrement r√©ussi")

//switch to Rec
Windows.switchToWindowTitle(GlobalVariable.version)


//Close the Passerelle Bilan page
Windows.click(findWindowsObject('Object Repository/General/closeMenu'))

//wait for 5 minutes for the changes to be applied
Windows.delay(350)

//Make a search for Passerelle Bilan-H.Bilan French - IFRS a second time 
WindowsImageKeywords.clickImage(images.menuImage)

//Make a filter
menuSearch.filterWithTextField(images.section,"PFL")
menuSearch.filterWithTextField(images.remett,"LOAN")
menuSearch.filterWithTextField(images.seuilsJustif,"Commenter")
menuSearch.filterWithTextField(images.statut,"En attent de validation")

//Add a justification file
table.AjouterUnFichierJustificatif()

common.checkMessage(images.message2,"erreur")
WindowsImageKeywords.clickImage(images.okBtn)

table.SupprimerUnFichierJustificatif()



	
	void AjouterUnFichierJustificatif () {

		mouseHandler.rightScreenClickCoordination(1450,270)

		Windows.delay(2)

		WindowsImageKeywords.clickImage(imagesPassele.ajouterJustificatif)

		Windows.delay(3)

		Windows.switchToWindowTitle("Passerelle French - IFRS : Ajouter un fichier justificatif")

		Windows.waitForElementPresent(findWindowsObject('Object Repository/Passarele Bilan/Ajouter un fichier justificatif'), 5)

		Windows.click(findWindowsObject('Object Repository/Passarele Bilan/Select File Button'))

		common.importFile(RunConfiguration.projectDir +"/Data Files/Passerelle Bilan/PasserelleBilan.xlsx")
		Windows.sendKeys(null, Keys.ENTER)

		WindowsImageKeywords.clickImage(images.okBtn)
	}
	
	void SupprimerUnFichierJustificatif () {
		
			mouseHandler.rightScreenClickCoordination(1450,270)
		
			Windows.delay(2)
		
			WindowsImageKeywords.clickImage(imagesPassele.supprimer)
		
			Windows.delay(3)

		}


	void importFile(String fileName) {
		Export export = new Export()

		StringSelection stringSelection = new StringSelection(fileName)
		Toolkit.getDefaultToolkit().getSystemClipboard().setContents(stringSelection, null)
		Windows.delay(2)

		WindowsImageKeywords.clickImage(images.fileTopDialog)
		export.simulateCtrlV()

		Windows.delay(2)

		WindowsImageKeywords.clickImage(imagesPassarele.passerelleBilanFile)

		Windows.delay(2)

		WindowsImageKeywords.clickImage(images.open)
	}


TEST SUITE: Passerelle Bilan H Bilan French IFRSExpand All
Full Name:	Passerelle Bilan H Bilan French IFRS
Start / End / Elapsed:	2026-01-15 11:38:48.015 / 2026-01-15 11:46:29.757 / 00:07:41.742
Status:	4 test total, 2 passed, 0 failed, 2 error, 0 incomplete, 0 skipped
TEST CASE: Test Cases/Connection/eMatch - Login RECExpand All
TEST CASE: Test Cases/Passerelle Bilan H Bilan French IFRS/Passerelle Bilan H Bilan French IFRSExpand All
Full Name:	Passerelle Bilan H Bilan French IFRS/Test Cases/Passerelle Bilan H Bilan French IFRS/Passerelle Bilan H Bilan French IFRS
Start / End / Elapsed:	2026-01-15 11:41:01.496 / 2026-01-15 11:45:59.320 / 00:04:57.824
Status:	ERROR
Message:	Test Cases/Passerelle Bilan H Bilan French IFRS/Passerelle Bilan H Bilan French IFRS FAILED.
Reason:
java.lang.Exception: Cannot recognise image on screen
	at com.katalon.keywords.windows.DesktopScreenUtil.clickImage(DesktopScreenUtil.groovy:41)
	at com.katalon.keywords.windows.DesktopScreenUtil$clickImage.call(Unknown Source)
	at com.katalon.keywords.windows.WindowsImageKeywords.clickImage(WindowsImageKeywords.groovy:14)
	at com.katalon.keywords.windows.WindowsImageKeywords$clickImage.call(Unknown Source)
	at general.Common.importFile(Common.groovy:71)
	at general.Common$importFile.call(Unknown Source)
	at general.Table.AjouterUnFichierJustificatif(Table.groovy:46)
	at general.Table$AjouterUnFichierJustificatif.call(Unknown Source)
	at Passerelle Bilan H Bilan French IFRS.run(Passerelle Bilan H Bilan French IFRS:44)
	at com.kms.katalon.core.main.ScriptEngine.run(ScriptEngine.java:194)
	at com.kms.katalon.core.main.ScriptEngine.runScriptAsRawText(ScriptEngine.java:119)
	at com.kms.katalon.core.main.TestCaseExecutor.runScript(TestCaseExecutor.java:430)
	at com.kms.katalon.core.main.TestCaseExecutor.doExecute(TestCaseExecutor.java:421)
	at com.kms.katalon.core.main.TestCaseExecutor.processExecutionPhase(TestCaseExecutor.java:400)
	at com.kms.katalon.core.main.TestCaseExecutor.accessMainPhase(TestCaseExecutor.java:392)
	at com.kms.katalon.core.main.TestCaseExecutor.execute(TestCaseExecutor.java:273)
	at com.kms.katalon.core.main.TestSuiteExecutor.accessTestCaseMainPhase(TestSuiteExecutor.java:202)
	at com.kms.katalon.core.main.TestSuiteExecutor.accessTestSuiteMainPhase(TestSuiteExecutor.java:164)
	at com.kms.katalon.core.main.TestSuiteExecutor.execute(TestSuiteExecutor.java:105)
	at com.kms.katalon.core.main.TestCaseMain.startTestSuite(TestCaseMain.java:185)
	at com.kms.katalon.core.main.TestCaseMain$startTestSuite$0.call(Unknown Source)
	at TempTestSuite1768477122431.run(TempTestSuite1768477122431.groovy:36)
TEST STEP: Start listener action : beforeCase
TEST STEP: menuName = "Passerelle Bilan"
TEST STEP: imageLoader = new general.ImageLoader()
TEST STEP: menuSearch = new general.MenuSearch()
TEST STEP: common = new general.Common()
TEST STEP: table = new general.Table()
TEST STEP: images = imageLoader.loadImagePassarele()
TEST STEP: imagesGeneral = imageLoader.loadImagesGeneral()
TEST STEP: frmt = DateTimeFormatter.ofPattern("dd/MM/yyyy")
TEST STEP: recAsOfDate = LocalDate.parse(getText(findWindowsObject("General/curArreteDate")), frmt)
TEST STEP: recAsOfDate = recAsOfDate
TEST STEP: callTestCase(findTestCase("Connection/change env - Admin group"), [:], STOP_ON_FAILURE)
TEST STEP: menuSearch.openAndSearch(menuName, menuImage, 25)
TEST STEP: menuSearch.filterWithTextField(section, "PFL")
TEST STEP: menuSearch.filterWithTextField(remett, "LOAN")
TEST STEP: menuSearch.filterWithTextField(seuilsJustif, "Commenter")
TEST STEP: menuSearch.filterWithTextField(statut, "Non Justifi")
TEST STEP: menuSearch.checkIfFilterWasApplied(sectionFilter1)
TEST STEP: table.AjouterUnFichierJustificatif()
Start / End / Elapsed:	2026-01-15 11:45:37.707 / 2026-01-15 11:45:55.352 / 00:00:17.645
11:45:40.354	PASSED	Delayed 2 second(s)                             	
11:45:44.500	PASSED	Delayed 3 second(s)                             	
11:45:44.510	INFO	Start finding a window that matches with title 'Passerelle French - IFRS : Ajouter un fichier justificatif' in 120.000 millisecond(s)                             	
11:45:48.015	PASSED	Switch to window 'Passerelle French - IFRS : Ajouter un fichier justificatif' successfully                             	
11:45:48.189	PASSED	Object 'Object Repository/Passarele Bilan/Ajouter un fichier justificatif' is present                             	
11:45:48.930	INFO	Clicking on element: Object Repository/Passarele Bilan/Select File Button                             	
11:45:49.218	PASSED	Click on element: Object Repository/Passarele Bilan/Select File Button succesfully                             	
11:45:51.631	PASSED	Delayed 2 second(s)                             	
11:45:54.779	PASSED	Delayed 2 second(s)                             	
11:45:55.352	ERROR	Test Cases/Passerelle Bilan H Bilan French IFRS/Passerelle Bilan H Bilan French IFRS FAILED.
Reason:
java.lang.Exception: Cannot recognise image on screen
	at com.katalon.keywords.windows.DesktopScreenUtil.clickImage(DesktopScreenUtil.groovy:41)
	at com.katalon.keywords.windows.DesktopScreenUtil$clickImage.call(Unknown Source)
	at com.katalon.keywords.windows.WindowsImageKeywords.clickImage(WindowsImageKeywords.groovy:14)
	at com.katalon.keywords.windows.WindowsImageKeywords$clickImage.call(Unknown Source)
	at general.Common.importFile(Common.groovy:71)
	at general.Common$importFile.call(Unknown Source)
	at general.Table.AjouterUnFichierJustificatif(Table.groovy:46)
	at general.Table$AjouterUnFichierJustificatif.call(Unknown Source)
	at Passerelle Bilan H Bilan French IFRS.run(Passerelle Bilan H Bilan French IFRS:44)
	at com.kms.katalon.core.main.ScriptEngine.run(ScriptEngine.java:194)
	at com.kms.katalon.core.main.ScriptEngine.runScriptAsRawText(ScriptEngine.java:119)
	at com.kms.katalon.core.main.TestCaseExecutor.runScript(TestCaseExecutor.java:430)
	at com.kms.katalon.core.main.TestCaseExecutor.doExecute(TestCaseExecutor.java:421)
	at com.kms.katalon.core.main.TestCaseExecutor.processExecutionPhase(TestCaseExecutor.java:400)
	at com.kms.katalon.core.main.TestCaseExecutor.accessMainPhase(TestCaseExecutor.java:392)
	at com.kms.katalon.core.main.TestCaseExecutor.execute(TestCaseExecutor.java:273)
	at com.kms.katalon.core.main.TestSuiteExecutor.accessTestCaseMainPhase(TestSuiteExecutor.java:202)
	at com.kms.katalon.core.main.TestSuiteExecutor.accessTestSuiteMainPhase(TestSuiteExecutor.java:164)
	at com.kms.katalon.core.main.TestSuiteExecutor.execute(TestSuiteExecutor.java:105)
	at com.kms.katalon.core.main.TestCaseMain.startTestSuite(TestCaseMain.java:185)
	at com.kms.katalon.core.main.TestCaseMain$startTestSuite$0.call(Unknown Source)
	at TempTestSuite1768477122431.run(TempTestSuite1768477122431.groovy:36)


