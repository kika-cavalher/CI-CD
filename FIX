import com.kms.katalon.core.windows.keyword.WindowsBuiltinKeywords as Windows
import org.openqa.selenium.Keys
import java.io.File

void importFile(String fullFilePath, int timeoutSec = 20) {

    File f = new File(fullFilePath)
    String folderPath = f.getParent()
    String fileNameOnly = f.getName()

    if (!folderPath || !fileNameOnly) {
        throw new IllegalArgumentException("Invalid path: " + fullFilePath)
    }

    focusOpenDialog(timeoutSec)

    Windows.delay(0.2)
    sendActive(Keys.chord(Keys.CONTROL, "l"))
    Windows.delay(0.2)

    sendActive(folderPath)
    Windows.delay(0.2)

    sendActive(Keys.ENTER)
    Windows.delay(0.6)

    sendActive(Keys.TAB)
    Windows.delay(0.15)
    sendActive(Keys.TAB)
    Windows.delay(0.15)

    sendActive(fileNameOnly)
    Windows.delay(0.2)

    sendActive(Keys.ENTER)
    Windows.delay(0.6)
}

void focusOpenDialog(int timeoutSec = 20) {

    long end = System.currentTimeMillis() + (timeoutSec * 1000)
    Exception last = null

    while (System.currentTimeMillis() < end) {
        try { Windows.switchToWindowTitle("Ouvrir"); return } catch (Exception e) { last = e }
        try { Windows.switchToWindowTitle("Open");   return } catch (Exception e) { last = e }
        try { Windows.switchToWindowTitle("Abrir");  return } catch (Exception e) { last = e }
        Windows.delay(0.2)
    }

    throw new Exception("Open dialog not found within " + timeoutSec + "s. Last error: " + (last?.getMessage() ?: "n/a"))
}

void sendActive(Object... seq) {
    CharSequence[] arr = seq.collect { (it instanceof CharSequence) ? (CharSequence) it : it.toString() } as CharSequence[]
    Windows.sendKeys(null, arr)
}
