import java.awt.Robot
import java.awt.event.KeyEvent
import java.io.File
import com.kms.katalon.core.windows.keyword.WindowsBuiltinKeywords as Windows

void importFile(String fullFilePath) {

    File f = new File(fullFilePath)
    String folderPath = f.getParent()
    String fileNameOnly = f.getName()

    if (folderPath == null || folderPath.trim().isEmpty()) {
        throw new IllegalArgumentException("Folder path is empty for: " + fullFilePath)
    }
    if (fileNameOnly == null || fileNameOnly.trim().isEmpty()) {
        throw new IllegalArgumentException("Filename is empty for: " + fullFilePath)
    }

    String folderNormalized = folderPath.replace("\\", "/")

    Robot r = new Robot()
    Windows.delay(0.5)

    chord(r, KeyEvent.VK_CONTROL, KeyEvent.VK_L)
    Windows.delay(0.2)

    typeText(r, folderNormalized)
    Windows.delay(0.2)

    tap(r, KeyEvent.VK_ENTER)
    Windows.delay(1.0)

    tap(r, KeyEvent.VK_TAB)
    Windows.delay(0.2)
    tap(r, KeyEvent.VK_TAB)
    Windows.delay(0.2)

    typeText(r, fileNameOnly)
    Windows.delay(0.2)

    tap(r, KeyEvent.VK_ENTER)
    Windows.delay(0.8)
}

void tap(Robot r, int key) {
    r.keyPress(key)
    r.keyRelease(key)
}

void chord(Robot r, int mod, int key) {
    r.keyPress(mod)
    r.keyPress(key)
    r.keyRelease(key)
    r.keyRelease(mod)
}

void typeText(Robot r, String text) {
    for (int i = 0; i < text.length(); i++) {
        typeChar(r, text.charAt(i))
        try { Thread.sleep(10) } catch (Exception ignored) {}
    }
}

void typeChar(Robot r, char c) {

    if (c >= 'a' && c <= 'z') {
        pressKey(r, KeyEvent.getExtendedKeyCodeForChar((int)c), false)
        return
    }

    if (c >= 'A' && c <= 'Z') {
        pressKey(r, KeyEvent.getExtendedKeyCodeForChar((int)c), true)
        return
    }

    if (c >= '0' && c <= '9') {
        pressKey(r, KeyEvent.getExtendedKeyCodeForChar((int)c), false)
        return
    }

    if (c == ' ') { tap(r, KeyEvent.VK_SPACE); return }
    if (c == '.') { tap(r, KeyEvent.VK_PERIOD); return }
    if (c == '-') { tap(r, KeyEvent.VK_MINUS); return }
    if (c == '_') { chord(r, KeyEvent.VK_SHIFT, KeyEvent.VK_MINUS); return }
    if (c == '/') { tap(r, KeyEvent.VK_SLASH); return }

    if (c == ':') {
        if (tryShiftCombo(r, KeyEvent.VK_SEMICOLON)) return
        if (tryShiftCombo(r, KeyEvent.VK_PERIOD)) return
        altCode(r, 58)
        return
    }

    if (c == '\\') {
        if (tryTap(r, KeyEvent.VK_BACK_SLASH)) return
        altCode(r, 92)
        return
    }

    int code = KeyEvent.getExtendedKeyCodeForChar((int)c)
    if (code == KeyEvent.VK_UNDEFINED || code <= 0) {
        throw new IllegalArgumentException("Unsupported char: [" + c + "] (code=" + code + ")")
    }

    boolean shift = Character.isUpperCase(c)
    pressKey(r, code, shift)
}

boolean tryTap(Robot r, int key) {
    try {
        tap(r, key)
        return true
    } catch (IllegalArgumentException e) {
        return false
    }
}

boolean tryShiftCombo(Robot r, int key) {
    try {
        chord(r, KeyEvent.VK_SHIFT, key)
        return true
    } catch (IllegalArgumentException e) {
        return false
    }
}

void pressKey(Robot r, int keyCode, boolean shift) {
    if (shift) r.keyPress(KeyEvent.VK_SHIFT)
    r.keyPress(keyCode)
    r.keyRelease(keyCode)
    if (shift) r.keyRelease(KeyEvent.VK_SHIFT)
}

void altCode(Robot r, int code) {
    String s = String.format("%04d", code)
    r.keyPress(KeyEvent.VK_ALT)
    for (int i = 0; i < s.length(); i++) {
        int digit = s.charAt(i) - '0'
        int key = KeyEvent.VK_NUMPAD0 + digit
        r.keyPress(key)
        r.keyRelease(key)
        try { Thread.sleep(10) } catch (Exception ignored) {}
    }
    r.keyRelease(KeyEvent.VK_ALT)
}
