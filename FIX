void importFile(String fileName) {

    Export export = new Export()

    StringSelection stringSelection = new StringSelection(fileName)
    Toolkit.getDefaultToolkit().getSystemClipboard().setContents(stringSelection, null)
    Windows.delay(2)

    // âœ… Keep image selection exactly as you already do, but safer
    clickImageSafe(images.fileTopDialog, "fileTopDialog", 20)
    export.simulateCtrlV()
    Windows.delay(2)

    clickImageSafe(imagesPassarele.passerelleBilanFile, "passerelleBilanFile", 20)
    Windows.delay(2)

    clickImageSafe(images.open, "openBtn", 20)
}

/* =========================================================
   Safe click wrapper
   - retries
   - on final failure: screenshot + template copy to report
   ========================================================= */
void clickImageSafe(String templatePath, String tag, int timeoutSec = 15) {

    long end = System.currentTimeMillis() + (timeoutSec * 1000)
    Exception last

    copyTemplateToReport(templatePath, "TEMPLATE_" + tag)

    while (System.currentTimeMillis() < end) {
        try {
            WindowsImageKeywords.clickImage(templatePath)
            return
        } catch (Exception e) {
            last = e
            Windows.delay(1)
        }
    }

    String shot = saveDebugScreenshot("IMG_NOT_FOUND_" + tag)
    KeywordUtil.logInfo("ðŸ“¸ Screenshot saved: " + shot)

    throw last ?: new Exception("Cannot recognise image on screen: " + templatePath)
}

String saveDebugScreenshot(String name) {
    String folder = RunConfiguration.getReportFolder()
    String path = folder + "/" + name + "_" + System.currentTimeMillis() + ".png"
    Windows.takeScreenshot(path)
    return path
}

void copyTemplateToReport(String templatePath, String name) {
    try {
        String folder = RunConfiguration.getReportFolder()
        String out = folder + "/" + name + ".png"
        Files.copy(Paths.get(templatePath), Paths.get(out), StandardCopyOption.REPLACE_EXISTING)
        KeywordUtil.logInfo("ðŸ§© Template copied to: " + out)
    } catch (Exception e) {
        KeywordUtil.logInfo("ðŸ§© Could not copy template: " + e.getMessage())
    }
}
